services:
  telegram-bot-api:
    image: aiogram/telegram-bot-api:latest
    environment:
      TELEGRAM_API_ID: ${TELEGRAM_API_ID}
      TELEGRAM_API_HASH: ${TELEGRAM_API_HASH}
      TELEGRAM_LOCAL: "1"
    volumes:
      - shared:/var/lib/telegram-bot-api
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:8081"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s

  bot:
    build: .
    environment:
      BOT_TOKEN: ${BOT_TOKEN}
      TELEGRAM_API_URL: http://telegram-bot-api:8081
      SHARED_DIR: /shared
    volumes:
      - shared:/shared
    depends_on:
      telegram-bot-api:
        condition: service_healthy
    restart: unless-stopped

volumes:
  shared:
